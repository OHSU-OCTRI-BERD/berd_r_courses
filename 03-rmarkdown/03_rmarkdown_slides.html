<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Reproducible Reports with R Markdown</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jessica Minnier, PhD &amp; Meike Niederhausen, PhD OCTRI Biostatistics, Epidemiology, Research &amp; Design (BERD) Workshop" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="css/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

# Reproducible Reports with R Markdown
### Jessica Minnier, PhD &amp; Meike Niederhausen, PhD<br><span style="font-size: 80%;"><a href="https://www.ohsu.edu/xd/research/centers-institutes/octri/education-training/octri-research-forum.cfm">OCTRI Biostatistics, Epidemiology, Research &amp; Design (BERD) Workshop</a> </span>
### <span style="font-size: 80%;">2019/07/18 <br><br><br> <i class="fas  fa-link "></i> slides: <a href="http://bit.ly/berd_rmd">bit.ly/berd_rmd</a> <br> <i class="fas  fa-file-pdf "></i> pdf: <a href="http://bit.ly/berd_rmd_pdf">bit.ly/berd_rmd_pdf</a></span>

---


layout: true
  
&lt;!-- &lt;div class="my-footer"&gt;&lt;span&gt;bit.ly/berd_tidy&lt;/span&gt;&lt;/div&gt;  --&gt;

---









# Load files for today's workshop

.pull-left[
- 
]

.pull-right[
`# install.packages("knitr")`  
`library(knitr)`
]

&lt;center&gt;&lt;img src="img/horst_rmarkdown_wizards.png" width="50%" height="50%"&gt;&lt;/center&gt;[Allison Horst](https://github.com/allisonhorst/stats-illustrations)

---

# Learning objectives

&lt;!-- TO-DO: update after finishing rest of slides --&gt;

---

class: middle, inverse

# Why Reproducibility?


- Evidence your results are correct.
- Allow others to use our methods and results.

"An article about computational results is advertising, not scholarship. The actual scholarship is the full software environment, code and data, that produced the result."

[(Claerbout and Karrenbach 1992)](http://sepwww.stanford.edu/doku.php?id=sep:research:reproducible:seg92)

---

# Types of Reproducibility

- **Computational reproducibility:** detailed information is provided about *code, software, hardware and implementation details*.
- **Empirical reproducibility:** detailed information is provided about non-computational empirical *scientific experiments and observations [data]*. 
- **Statistical reproducibility:** detailed information is provided about the choice of *statistical tests, model parameters, threshold values, etc*.

[R Opensci Reproducibility Guide](https://ropensci.github.io/reproducibility-guide/sections/introduction/)

---

# Software tool for reproducibility: *Literate Programming*

&gt;These tools enable writing and publishing **self-contained documents that include narrative and code used to generate both text and graphical results**.

&gt;In the R ecosystem, knitr [R markdown] and its ancestor Sweave used with RStudio are the main tools for literate computing. Markdown or LaTeX are used for writing the narrative, with chunks of R code sprinkled throughout the narrative. IPython is a popular related system for the Python language, providing an interactive notebook for browser-based literate computing."

[R Opensci Reproducibility Guide](https://ropensci.github.io/reproducibility-guide/sections/introduction/)

---

# R Markdown = `.Rmd` file

Code + text (in markdown syntax)

`knitr` is a package that converts `.Rmd` files containing code + markdown syntax to a plain text `.md` markdown file, and then to other formats (html, pdf, Word, etc)


&lt;img src="img/ex_rmd.png" width="45%" align="top"&gt; `\(\Rightarrow\)`
&lt;img src="img/ex_html.png" width="45%" align="top"&gt;


---

# knitr converts `.Rmd` -&gt; `.md`

.pull-left[
&lt;img src="img/ex_rmd.png" width="100%" height="60%"&gt;
]

.pull-right[
&lt;img src="img/ex_md.png" width="100%" height="60%"&gt;
]

---

# knitr converts `.Rmd` -&gt; `.md` -&gt; `.html`

.pull-left[
&lt;img src="img/ex_rmd_html.png" width="100%" height="60%"&gt;
]

.pull-right[
&lt;img src="img/ex_html.png" width="100%" height="60%"&gt;
]

---

# knitr converts `.Rmd` -&gt; `.md` -&gt; `.pdf`

.pull-left-40[
&lt;img src="img/ex_rmd_pdf.png" width="100%" height="60%"&gt;
]

.pull-right-60[
&lt;img src="img/ex_pdf2.png" width="100%" height="60%"&gt;
]

---

# knitr converts `.Rmd` -&gt; `.md` -&gt; `.doc`

.pull-left[
&lt;img src="img/ex_rmd_word.png" width="100%" height="60%"&gt;
]

.pull-right[
&lt;img src="img/ex_word.png" width="50%" height="60%"&gt;
]

---

# knitr converts `.Rmd` -&gt; `.md` -&gt; slides

.pull-left[
&lt;img src="img/ex_ioslides.png" width="100%" height="60%"&gt;
]

.pull-right[
&lt;img src="img/ex_slides.png" width="80%" height="60%"&gt;
]



---

# R Markdown vs. `knitr::knit()`


&lt;center&gt;&lt;img src="img/knitr_workflow_sachsmc.png" width="80%" height="80%"&gt;&lt;/center&gt;[Michael Sachs](https://sachsmc.github.io/knit-git-markr-guide/knitr/knit.html)



---

# Good practices in RStudio

__Use projects__ ([read this](https://r4ds.had.co.nz/workflow-projects.html))
- Create an RStudio project for each data analysis project
- Sets *working directory*
- A project is associated with a directory folder
    + Keep data files there
    + Keep scripts there; edit them, run them in bits or as a whole
    + Save your outputs (plots and cleaned data) there
- Only use relative paths, never absolute paths
    + relative (good): `read_csv("data/mydata.csv")`
    + absolute (bad): `read_csv("/home/yourname/Documents/stuff/mydata.csv")`
    
__Advantages of using projects__
- standardize file paths
- keep everything together
- a whole folder can be shared and run on another computer

---

# INSERT MEIKE'S SLIDES HERE

---


class: center, middle, inverse

# Reproducible Workflow

---

# Be Organized

Your files must make sense to yourself 6 months from now, and/or other collaborators.
&lt;center&gt;&lt;img src="img/jenny_filesalad.png" width="90%" height="50%"&gt;&lt;/center&gt;[Jenny Bryan's "What They Forgot to Teach you About R" Rstudio::conf2018 training](https://github.com/jennybc/what-they-forgot)

---

# No! Absolute! File! Paths! (don't `setwd()`)

Absolute paths `\(\neq\)` reproducible

Relative paths `\(=\)` reproducible (if done correctly)

&lt;center&gt;&lt;img src="img/jenny_filepath.png" width="80%" height="50%"&gt;&lt;/center&gt;

[Jenny Bryan](https://jennybryan.org/about/)'s oft quoted opinion, See post on [Project-oriented
workflow](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)

---

# Project directory structure

- .Rproj sets your working directory (**USE [PROJECTS](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)**)


```r
# Use a relative path, "relative to" the project folder
read_csv("mydata.csv") # looks in .Rproj folder
```


- .Rmd files when knit look for sourced files *in the folder they live in*

````
```{r data, eval=TRUE}
read_csv("mydata.csv") # looks in .Rmd folder
```
````

- It's good practice to organize all your code/data/output into separate folders

These three facts together can cause a headache. Enter `here::here()`!

---

# Everything in one folder

&lt;img src="img/report2_same_folder_input.png" width="80%" height="60%"&gt;

After knitting, this gives you (file ðŸ¥—)

&lt;img src="img/report2_same_folder_inputandoutput.png" width="80%" height="60%"&gt;

---

# Slightly more organized

&lt;img src="img/report3_subfolder_input.png" width="70%" height="60%"&gt;


After knitting, this gives you:
&lt;img src="img/report3_subfolder_inputandoutput.png" width="70%" height="60%"&gt;



---

# A tip about "moving up" a directory/folder

- In unix, to point to the folder one level up (it contains the folder you're in), use `../`
- As in `cd ..` moves up one directory, or `cp ../myfile.txt newfile.txt` this copies a file one level up into the current folder (working directory)
- When you want to source the data, you could use `../` to move up a folder into the main directory, and then back down into the `data/` folder:


```r
# From the .Rmd folder, move up one folder then down to the data folder
mydata &lt;- read_csv("../data/report3_nhanes_data.csv")
```

&lt;img src="img/report3_subfolder_input.png" width="70%" height="60%"&gt;



---

# That was confusing, right? Use `here::here()`!


&lt;center&gt;&lt;img src="img/horst_here.png" width="50%" height="50%"&gt;&lt;a href="https://github.com/allisonhorst/stats-illustrations"&gt;&lt;br&gt;Allison Horst&lt;/a&gt;&lt;/center&gt;



---

# `here::here()` `\(\rightarrow\)` relative paths to the project directory

- The `here` package's `here()` function solves this issue of inconsistent working directories.
- The point of Rstudio project workflow is to always have the same "home" working directory = where the `.Rproj` file is.
- `here::here()` returns the project directory as a string
- Fully reproducible if the whole folder is moved or shared or posted to github
- Portable to ALL systems (Mac, PC, unix), don't worry about `/` or `\` or spaces etc


```r
here::here()
```

```
[1] "/Users/minnier/Google Drive/BERD R Classes/berd_r_courses_github"
```

---

# `here::here()` with folders and filenames

- `here::here("folder","filename")` returns the entire file path as a string
- These file paths work when running an `.Rmd` file interactively like a notebook, when knitting it, when copying it to the console, wherever, whenever!!


```r
here::here("data","mydatafile.csv")
```

```
[1] "/Users/minnier/Google Drive/BERD R Classes/berd_r_courses_github/data/mydatafile.csv"
```


```r
here::here("data","raw-data","mydatafile.csv")
```

```
[1] "/Users/minnier/Google Drive/BERD R Classes/berd_r_courses_github/data/raw-data/mydatafile.csv"
```

We will explore how and when to use this in the exercises.

---

# Exercises:

- Open `report2.Rmd`
- Open `report3/report3.Rmd`
- Open `report3-here/report3_here.Rmd`

---

class: center, middle, inverse

# Extensions

---

---

# Possible Future Workshop Topics?

- tables
- ggplot2 visualization
- advanced tidyverse: functions, purrr (apply/map)
- statistical modeling in R

---

## Contact info:

Jessica Minnier: _minnier@ohsu.edu_

Meike Niederhausen: _niederha@ohsu.edu_


## This workshop info:

&lt;!-- TO-DO: Update??? Create file with jsut the R code--&gt;

- Code for these slides on github: [jminnier/berd_r_courses](https://github.com/jminnier/berd_r_courses)
- all the [R code in an R script](https://jminnier-berd-r-courses.netlify.com/03-rmarkdown/03_rmarkdown.R)
- answers to practice problems can be found here: [html](https://jminnier-berd-r-courses.netlify.com/03-rmarkdown/03_rmarkdown.html)


&lt;!-- TO DO: move all images to project folder so print pdf below works? --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "tomorrow",
"highlightLines": true,
"highlightLanguage": "r",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
